name: DevOps CI Pipeline

# 1. TRIGGER: Run on push, PR, or Manually
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch: 

jobs:
  # 2. JOB: Verify Frontend (React + Vite)
  frontend-ci:
    name: Frontend Quality Check
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./Frontend 

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: './Frontend/package-lock.json' 

    - name: Install Frontend Dependencies
      run: npm ci

    # A. Static Code Analysis (Linting)
    - name: Run ESLint
      run: npm run lint
      continue-on-error: true 

    # B. Build Test
    - name: Verify Build
      run: npm run build

  # 3. JOB: Verify Backend (Node + Express)
  backend-ci:
    name: Backend Quality Check
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./Backend 

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: './Backend/package-lock.json' 

    - name: Install Backend Dependencies
      run: npm ci

    # A. Verify Syntax/Linting
    - name: Basic Sanity Check
      run: node -e "console.log('Backend syntax is valid')"